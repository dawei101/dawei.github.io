---
id: 280
title: 文明盛世 超能饮料谜题答案
date: 2014-04-21T17:50:08+00:00
author: dawei
layout: post
guid: http://bookwikiup.com/blog/?p=280
permalink: /2014/04/21/%e6%96%87%e6%98%8e%e7%9b%9b%e4%b8%96-%e8%b6%85%e8%83%bd%e9%a5%ae%e6%96%99%e8%b0%9c%e9%a2%98%e7%ad%94%e6%a1%88/
categories:
  - Tech

---
文明盛世超能饮料谜题, 是号称价值百万年薪的题. 不过<span style="color: #800000;">噱头太大了, 完全是炒作.</span>

<pre>尊敬的投稿者，

您好，感谢您向文明盛世提交谜题解答方案。您的解答方案（收到时间：2014年03月31日，15点31分）(id为:2447)成功解决了谜题chemical

-如果有任何其他方面的疑问，请将您所碰到的问题详细描述清楚并发送到：puzzlerobot@wmsstech.com

再次感谢您的支持！

-The puzzle robot
</pre>

有很多迷友痴迷于此题，我看到csdn有位仁兄自题目出生就一直在给出解答，却没有一个时间复杂度达标的。面试已经过去很长时间了，今天我把此题的一个解答贴出来，让所有深陷其中的谜友们解脱掉，也清醒一下。文明盛世不只需要一个有钻研能力与创造力的工程师，而是需要一个可以独当一面经验丰富的高级工程师。

我觉得这道题确实非常迷人，希望喜欢这道题的同学能各抒己见，让我看到另一种解答。

说一下谜题，其实谜题没什么特别高深的，就是一个更符合现实的NTSP问题。

<span style="color: #800000;"><strong>本题我用过很多种非优化算法，但最终解决的是这个遗传算法。如果不考虑收敛速度，蚁群算法应该也可以，还有粒子群算法会更合适。</strong></span>

我对本题的解决思路就是要建立起一个可量化基因优良性的化合物组合，然后再通过能够保留优良基因的交配办法，最终经过多次杂交与灾变达到最优结果的目的。

遗传算法本身就是基于概率出来的，所以虽然本解决方案灾变数次，但仍然会有极小极小的概率得到局部最优。

其中灾变次数的设置应该可以根据化合物的数量确定灾变次数，本解答直接设置为常量, 因为应付本题足够。如果您也有好的解决思路，欢迎一起交流。

* * *

&nbsp;

该份代码用我的笔记本经过数次测试, 16个化合物大约1.5-2.5分钟.而文明盛世的服务器非常快, 估计30秒钟就计算完毕.

<a href="http://bookwikiup.com/wp-content/uploads/chemical" target="_blank">源码附件</a>下载

源码如下:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/python</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">time</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">re</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">random</span>
&nbsp;
TMAP <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
CS <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
C1MS <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
C2MS <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
P_LEN <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">50</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> read_data<span style="color: black;">&#40;</span>fpath<span style="color: black;">&#41;</span>:
    f <span style="color: #66cc66;">=</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span>fpath<span style="color: black;">&#41;</span>
    cs_set <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> line <span style="color: #ff7700;font-weight:bold;">in</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">strip</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">split</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\</span>
'</span><span style="color: black;">&#41;</span>:
        m<span style="color: #66cc66;">,</span> c1<span style="color: #66cc66;">,</span> c2<span style="color: #66cc66;">,</span> p <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">re</span>.<span style="color: black;">match</span><span style="color: black;">&#40;</span>
            r<span style="color: #483d8b;">'M(<span style="color: #000099; font-weight: bold;">\d</span>+)[<span style="color: #000099; font-weight: bold;">\t</span> ]+(C<span style="color: #000099; font-weight: bold;">\d</span>+)[<span style="color: #000099; font-weight: bold;">\t</span> ]+(C<span style="color: #000099; font-weight: bold;">\d</span>+)[<span style="color: #000099; font-weight: bold;">\t</span> ]+(<span style="color: #000099; font-weight: bold;">\d</span>+)'</span><span style="color: #66cc66;">,</span> line.<span style="color: black;">strip</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>.<span style="color: black;">group</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: black;">&#41;</span>
        m <span style="color: #66cc66;">=</span> Machine<span style="color: black;">&#40;</span>m<span style="color: #66cc66;">,</span> p<span style="color: #66cc66;">,</span> c1<span style="color: #66cc66;">,</span> c2<span style="color: black;">&#41;</span>
        TMAP<span style="color: black;">&#91;</span><span style="color: black;">&#40;</span>c1<span style="color: #66cc66;">,</span> c2<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> m
        <span style="color: #ff7700;font-weight:bold;">if</span> c1 <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> C1MS:
            C1MS<span style="color: black;">&#91;</span>c1<span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        C1MS<span style="color: black;">&#91;</span>c1<span style="color: black;">&#93;</span>.<span style="color: black;">append</span><span style="color: black;">&#40;</span>m<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> c2 <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> C2MS:
            C2MS<span style="color: black;">&#91;</span>c2<span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        C2MS<span style="color: black;">&#91;</span>c2<span style="color: black;">&#93;</span>.<span style="color: black;">append</span><span style="color: black;">&#40;</span>m<span style="color: black;">&#41;</span>
        cs_set.<span style="color: black;">add</span><span style="color: black;">&#40;</span>c1<span style="color: black;">&#41;</span>
    f.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">for</span> ms <span style="color: #ff7700;font-weight:bold;">in</span> C1MS.<span style="color: black;">values</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        ms.<span style="color: black;">sort</span><span style="color: black;">&#40;</span>key<span style="color: #66cc66;">=</span><span style="color: #ff7700;font-weight:bold;">lambda</span> m: m.<span style="color: black;">price</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> ms <span style="color: #ff7700;font-weight:bold;">in</span> C2MS.<span style="color: black;">values</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        ms.<span style="color: black;">sort</span><span style="color: black;">&#40;</span>key<span style="color: #66cc66;">=</span><span style="color: #ff7700;font-weight:bold;">lambda</span> m: m.<span style="color: black;">price</span><span style="color: black;">&#41;</span>
&nbsp;
    CS.<span style="color: black;">extend</span><span style="color: black;">&#40;</span><span style="color: #008000;">list</span><span style="color: black;">&#40;</span>cs_set<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Machine<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> m<span style="color: #66cc66;">,</span> p<span style="color: #66cc66;">,</span> fc<span style="color: #66cc66;">,</span> tc<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: #008000;">id</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">price</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>m<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>p<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">from_c</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">to_c</span> <span style="color: #66cc66;">=</span> fc<span style="color: #66cc66;">,</span> tc
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> optimized_mlsts<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        i<span style="color: #66cc66;">,</span> j <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;"></span>
        <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
            mt <span style="color: #66cc66;">=</span> C1MS<span style="color: black;">&#91;</span><span style="color: #008000;">self</span>.<span style="color: black;">from_c</span><span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span>
            mf <span style="color: #66cc66;">=</span> C2MS<span style="color: black;">&#91;</span><span style="color: #008000;">self</span>.<span style="color: black;">to_c</span><span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>j<span style="color: black;">&#93;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> mt.<span style="color: black;">price</span> + mf.<span style="color: black;">price</span> &lt<span style="color: #66cc66;">;</span> <span style="color: #008000;">self</span>.<span style="color: black;">price</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> mt<span style="color: #66cc66;">,</span> mf
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> mt.<span style="color: black;">price</span> &lt<span style="color: #66cc66;">;</span> mf.<span style="color: black;">price</span>:
                i +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                j +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__str__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">"Machine:%s, %s[%s&gt;%s]"</span> % <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: #008000;">id</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">price</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">from_c</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">to_c</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> DNA<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cs<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">cs</span> <span style="color: #66cc66;">=</span> cs<span style="color: black;">&#91;</span>:<span style="color: black;">&#93;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">cost</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
        <span style="color: #008000;">self</span>.<span style="color: black;">fit_rate</span>  <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
        <span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>TMAP<span style="color: black;">&#91;</span><span style="color: black;">&#40;</span>cs<span style="color: black;">&#91;</span>i-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> cs<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>cs<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>._ms <span style="color: #66cc66;">=</span> <span style="color: #008000;">None</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_fitness<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">1.0</span>/<span style="color: #008000;">self</span>.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_cost<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">cost</span> <span style="color: #66cc66;">==</span> <span style="color: #ff4500;"></span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> m <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span><span style="color: black;">&#91;</span>:<span style="color: black;">&#93;</span>:
                <span style="color: #ff7700;font-weight:bold;">for</span> m1<span style="color: #66cc66;">,</span> m2 <span style="color: #ff7700;font-weight:bold;">in</span> m.<span style="color: black;">optimized_mlsts</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
                    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">instead</span><span style="color: black;">&#40;</span>m<span style="color: #66cc66;">,</span> m1<span style="color: #66cc66;">,</span> m2<span style="color: black;">&#41;</span>:
                        <span style="color: #ff7700;font-weight:bold;">break</span>
            <span style="color: #008000;">self</span>.<span style="color: black;">cost</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">sum</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>m.<span style="color: black;">price</span> <span style="color: #ff7700;font-weight:bold;">for</span> m <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">cost</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> instead<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> m<span style="color: #66cc66;">,</span> m1<span style="color: #66cc66;">,</span> m2<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> m.<span style="color: black;">from_c</span> <span style="color: #66cc66;">!=</span> m1.<span style="color: black;">from_c</span>:
            m1<span style="color: #66cc66;">,</span> m2 <span style="color: #66cc66;">=</span> m2<span style="color: #66cc66;">,</span> m1
        i <span style="color: #66cc66;">=</span> <span style="color: #008000;">None</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> j<span style="color: #66cc66;">,</span> m0 <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> m0 <span style="color: #66cc66;">==</span> m:
                i <span style="color: #66cc66;">=</span> j
                <span style="color: #ff7700;font-weight:bold;">break</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> i <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">True</span>
        i <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span>.<span style="color: black;">index</span><span style="color: black;">&#40;</span>m<span style="color: black;">&#41;</span>
        new_ms <span style="color: #66cc66;">=</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>
            <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span><span style="color: black;">&#91;</span>:i<span style="color: black;">&#93;</span> + <span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span><span style="color: black;">&#91;</span>i+<span style="color: #ff4500;">1</span>:<span style="color: black;">&#93;</span> + <span style="color: black;">&#91;</span>m1<span style="color: #66cc66;">,</span> m2<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        track_d <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> m <span style="color: #ff7700;font-weight:bold;">in</span> new_ms:
            <span style="color: #ff7700;font-weight:bold;">if</span> m.<span style="color: black;">from_c</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> track_d: track_d<span style="color: black;">&#91;</span>m.<span style="color: black;">from_c</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
            track_d<span style="color: black;">&#91;</span>m.<span style="color: black;">from_c</span><span style="color: black;">&#93;</span>.<span style="color: black;">append</span><span style="color: black;">&#40;</span>m<span style="color: black;">&#41;</span>
        ps <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>m1.<span style="color: black;">to_c</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
        end_p <span style="color: #66cc66;">=</span> m2.<span style="color: black;">from_c</span>
        tracked_ps <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">while</span> end_p <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> ps:
            nps <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>m.<span style="color: black;">to_c</span> <span style="color: #ff7700;font-weight:bold;">for</span> p <span style="color: #ff7700;font-weight:bold;">in</span> ps-tracked_ps <span style="color: #ff7700;font-weight:bold;">for</span> m <span style="color: #ff7700;font-weight:bold;">in</span> track_d<span style="color: black;">&#91;</span>p<span style="color: black;">&#93;</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
            tracked_ps.<span style="color: black;">update</span><span style="color: black;">&#40;</span>ps<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> nps:
                <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">False</span>
            ps <span style="color: #66cc66;">=</span> nps
        <span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span> <span style="color: #66cc66;">=</span> new_ms
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">True</span>
        <span style="color: #808080; font-style: italic;">#TODO</span>
        fms <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>m <span style="color: #ff7700;font-weight:bold;">for</span> m <span style="color: #ff7700;font-weight:bold;">in</span> track_d<span style="color: black;">&#91;</span>m1.<span style="color: black;">to_c</span><span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">if</span> m <span style="color: #66cc66;">!=</span> m1<span style="color: black;">&#93;</span>
        tms <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>m <span style="color: #ff7700;font-weight:bold;">for</span> m <span style="color: #ff7700;font-weight:bold;">in</span> new_ms <span style="color: #ff7700;font-weight:bold;">if</span> m.<span style="color: black;">from_c</span> <span style="color: #66cc66;">==</span> m2.<span style="color: black;">from_c</span> <span style="color: #ff7700;font-weight:bold;">and</span> m <span style="color: #66cc66;">!=</span> m2<span style="color: black;">&#93;</span>
        mgps <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#40;</span>m1<span style="color: #66cc66;">,</span> m2<span style="color: #66cc66;">,</span> TMAP<span style="color: black;">&#91;</span><span style="color: black;">&#40;</span>m1.<span style="color: black;">from_c</span><span style="color: #66cc66;">,</span> m2.<span style="color: black;">to_c</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> \
            <span style="color: #ff7700;font-weight:bold;">for</span> m1 <span style="color: #ff7700;font-weight:bold;">in</span> fms <span style="color: #ff7700;font-weight:bold;">for</span> m2 <span style="color: #ff7700;font-weight:bold;">in</span> tms <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: black;">&#40;</span>
                m1.<span style="color: black;">from_c</span><span style="color: #66cc66;">!=</span>m2.<span style="color: black;">to_c</span> <span style="color: #ff7700;font-weight:bold;">and</span> \
                TMAP<span style="color: black;">&#91;</span><span style="color: black;">&#40;</span>m1.<span style="color: black;">from_c</span><span style="color: #66cc66;">,</span> m2.<span style="color: black;">to_c</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>.<span style="color: black;">price</span>&lt<span style="color: #66cc66;">;</span>m1.<span style="color: black;">price</span>+m2.<span style="color: black;">price</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        ms <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">&#40;</span>mgps<span style="color: #66cc66;">,</span> key<span style="color: #66cc66;">=</span><span style="color: #ff7700;font-weight:bold;">lambda</span> mg: mg<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>.<span style="color: black;">price</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> ms:
            m1<span style="color: #66cc66;">,</span> m2<span style="color: #66cc66;">,</span> m <span style="color: #66cc66;">=</span> ms<span style="color: black;">&#91;</span><span style="color: #ff4500;"></span><span style="color: black;">&#93;</span>
            new_ms.<span style="color: black;">append</span><span style="color: black;">&#40;</span>m<span style="color: black;">&#41;</span>
            new_ms.<span style="color: black;">remove</span><span style="color: black;">&#40;</span>m1<span style="color: black;">&#41;</span>
            new_ms.<span style="color: black;">remove</span><span style="color: black;">&#40;</span>m2<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_ms<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">self</span>._ms:
            <span style="color: #008000;">self</span>._ms <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>m.<span style="color: #008000;">id</span> <span style="color: #ff7700;font-weight:bold;">for</span> m <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">optimized_ms</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._ms
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__str__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">' '</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #008000;">map</span><span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">get_ms</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__hash__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">hash</span><span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">get_ms</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__eq__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> dna<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>dna<span style="color: #66cc66;">,</span> DNA<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">and</span> <span style="color: #008000;">self</span>.<span style="color: black;">get_ms</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">==</span>dna.<span style="color: black;">get_ms</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
variation_rate <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0.4</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> variate<span style="color: black;">&#40;</span>dna<span style="color: black;">&#41;</span>:
    cs <span style="color: #66cc66;">=</span> dna.<span style="color: black;">cs</span><span style="color: black;">&#91;</span>:<span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #dc143c;">random</span>.<span style="color: black;">randint</span><span style="color: black;">&#40;</span><span style="color: #ff4500;"></span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span> &lt<span style="color: #66cc66;">;</span> variation_rate*<span style="color: #ff4500;">100</span>:
        mi <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
        <span style="color: #ff7700;font-weight:bold;">while</span> mi &lt<span style="color: #66cc66;">;</span> <span style="color: #ff4500;">4</span>:
            mi +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
            i <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">random</span>.<span style="color: black;">randint</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>cs<span style="color: black;">&#41;</span>-<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
            j <span style="color: #66cc66;">=</span> i
            <span style="color: #ff7700;font-weight:bold;">while</span> i<span style="color: #66cc66;">==</span>j:
                j <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">random</span>.<span style="color: black;">randint</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>cs<span style="color: black;">&#41;</span>-<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
            cs<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> cs<span style="color: black;">&#91;</span>j<span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> cs<span style="color: black;">&#91;</span>j<span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> cs<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> DNA<span style="color: black;">&#40;</span>cs<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Selector<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> dnas<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">dnas</span> <span style="color: #66cc66;">=</span> dnas
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> next<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        r <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">random</span>.<span style="color: #dc143c;">random</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        m <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
        <span style="color: #ff7700;font-weight:bold;">for</span> n <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">dnas</span>:
            m +<span style="color: #66cc66;">=</span> n.<span style="color: black;">fit_rate</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> m&gt<span style="color: #66cc66;">;=</span>r:
                <span style="color: #ff7700;font-weight:bold;">return</span> n
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> mate<span style="color: black;">&#40;</span>dnas<span style="color: black;">&#41;</span>:
&nbsp;
    sel <span style="color: #66cc66;">=</span> Selector<span style="color: black;">&#40;</span>dnas<span style="color: black;">&#41;</span>
    ns <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">&#40;</span>dnas<span style="color: black;">&#91;</span>:<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
    c <span style="color: #66cc66;">=</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>P_LEN * <span style="color: #ff4500;">1.5</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">while</span> c &gt<span style="color: #66cc66;">;</span> <span style="color: #ff4500;"></span>:
        d1 <span style="color: #66cc66;">=</span> sel.<span style="color: black;">next</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">cs</span>
        d2 <span style="color: #66cc66;">=</span> sel.<span style="color: black;">next</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">cs</span>
        k <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">random</span>.<span style="color: black;">randint</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>-<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>/<span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span>*<span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>-<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>/<span style="color: #ff4500;">4</span><span style="color: black;">&#41;</span>
        nd11<span style="color: #66cc66;">,</span> nd12 <span style="color: #66cc66;">=</span> d2<span style="color: black;">&#91;</span>:k<span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> d1<span style="color: black;">&#91;</span>k:<span style="color: black;">&#93;</span>
        nd21<span style="color: #66cc66;">,</span> nd22 <span style="color: #66cc66;">=</span> d1<span style="color: black;">&#91;</span>:k<span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> d2<span style="color: black;">&#91;</span>k:<span style="color: black;">&#93;</span>
        r1 <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>i <span style="color: #ff7700;font-weight:bold;">for</span> i<span style="color: #66cc66;">,</span> a <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">&#40;</span>nd11<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> a <span style="color: #ff7700;font-weight:bold;">in</span> nd12<span style="color: black;">&#93;</span>
        r2 <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>i <span style="color: #ff7700;font-weight:bold;">for</span> i<span style="color: #66cc66;">,</span> a <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">&#40;</span>nd21<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> a <span style="color: #ff7700;font-weight:bold;">in</span> nd22<span style="color: black;">&#93;</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>r1<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>:
            nd11<span style="color: black;">&#91;</span>r1<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> nd21<span style="color: black;">&#91;</span>r2<span style="color: black;">&#91;</span><span style="color: #ff4500;"></span>-i<span style="color: black;">&#93;</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> nd21<span style="color: black;">&#91;</span>r2<span style="color: black;">&#91;</span><span style="color: #ff4500;"></span>-i<span style="color: black;">&#93;</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> nd11<span style="color: black;">&#91;</span>r1<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: black;">&#93;</span>
        ndna1<span style="color: #66cc66;">,</span> ndna2 <span style="color: #66cc66;">=</span> DNA<span style="color: black;">&#40;</span>nd11+nd12<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> DNA<span style="color: black;">&#40;</span>nd21+nd22<span style="color: black;">&#41;</span>
        ns.<span style="color: black;">update</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>ndna1<span style="color: #66cc66;">,</span> ndna2<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> n <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#91;</span>ndna1<span style="color: #66cc66;">,</span> ndna2<span style="color: black;">&#93;</span>:
            nn <span style="color: #66cc66;">=</span> variate<span style="color: black;">&#40;</span>n<span style="color: black;">&#41;</span>
            nn <span style="color: #ff7700;font-weight:bold;">and</span> ns.<span style="color: black;">add</span><span style="color: black;">&#40;</span>nn<span style="color: black;">&#41;</span>
        c -<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>ns<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> count_fit_rate<span style="color: black;">&#40;</span>dnas<span style="color: #66cc66;">,</span> Record<span style="color: #66cc66;">,</span> max_len<span style="color: #66cc66;">=</span>P_LEN<span style="color: black;">&#41;</span>:
    dnas <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">&#40;</span>dnas<span style="color: #66cc66;">,</span> key<span style="color: #66cc66;">=</span><span style="color: #ff7700;font-weight:bold;">lambda</span> dna: dna.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span>:P_LEN<span style="color: black;">&#93;</span>
    s <span style="color: #66cc66;">=</span> <span style="color: #008000;">sum</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>dna.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> dna <span style="color: #ff7700;font-weight:bold;">in</span> dnas<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> dna <span style="color: #ff7700;font-weight:bold;">in</span> dnas:
        dna.<span style="color: black;">fit_rate</span> <span style="color: #66cc66;">=</span> dna.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>*<span style="color: #ff4500;">1.0</span>/s
    Record.<span style="color: black;">set_best</span><span style="color: black;">&#40;</span>dnas<span style="color: black;">&#91;</span><span style="color: #ff4500;"></span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> dnas
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> get_gp_dnas<span style="color: black;">&#40;</span>l<span style="color: #66cc66;">=</span>P_LEN<span style="color: black;">&#41;</span>:
    dnas <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>dnas<span style="color: black;">&#41;</span> &lt<span style="color: #66cc66;">;</span> l:
        <span style="color: #dc143c;">random</span>.<span style="color: black;">shuffle</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>
        dnas.<span style="color: black;">append</span><span style="color: black;">&#40;</span>DNA<span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> dnas
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Record<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    dna <span style="color: #66cc66;">=</span> <span style="color: #008000;">None</span>
&nbsp;
    rate_horizontal_rpt <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
    best_horizontal_rpt <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
&nbsp;
    <span style="color: #66cc66;">@</span><span style="color: #008000;">staticmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> set_best<span style="color: black;">&#40;</span>dna<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> dna <span style="color: #ff7700;font-weight:bold;">and</span> Record.<span style="color: black;">dna</span> <span style="color: #ff7700;font-weight:bold;">and</span> dna.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">==</span> Record.<span style="color: black;">dna</span>.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
            Record.<span style="color: black;">best_horizontal_rpt</span> +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            Record.<span style="color: black;">best_horizontal_rpt</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
            <span style="color: #ff7700;font-weight:bold;">if</span> dna <span style="color: #ff7700;font-weight:bold;">and</span> Record.<span style="color: black;">dna</span>:
                Record.<span style="color: black;">rate_horizontal_rpt</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;"></span>
        Record.<span style="color: black;">dna</span> <span style="color: #66cc66;">=</span> dna
&nbsp;
    <span style="color: #66cc66;">@</span><span style="color: #008000;">staticmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> catastrophe<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        Record.<span style="color: black;">rate_horizontal_rpt</span> +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
&nbsp;
    <span style="color: #66cc66;">@</span><span style="color: #008000;">staticmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> add_best_to_lst<span style="color: black;">&#40;</span>dnas<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> Record.<span style="color: black;">best_horizontal_rpt</span> &gt<span style="color: #66cc66;">;</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>:
            dnas.<span style="color: black;">append</span><span style="color: black;">&#40;</span>Record.<span style="color: black;">dna</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> dnas
&nbsp;
    <span style="color: #66cc66;">@</span><span style="color: #008000;">staticmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> should_catastrophe<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> Record.<span style="color: black;">best_horizontal_rpt</span> &gt<span style="color: #66cc66;">;</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>*<span style="color: #ff4500;">1.5</span>
&nbsp;
    <span style="color: #66cc66;">@</span><span style="color: #008000;">staticmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> is_best_enough<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> Record.<span style="color: black;">rate_horizontal_rpt</span> &gt<span style="color: #66cc66;">;=</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>*<span style="color: #ff4500;">1.5</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> run<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
&nbsp;
    start_t <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">time</span>.<span style="color: black;">clock</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    dnas <span style="color: #66cc66;">=</span> get_gp_dnas<span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>*P_LEN<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #ff7700;font-weight:bold;">not</span> Record.<span style="color: black;">is_best_enough</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> Record.<span style="color: black;">should_catastrophe</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
            Record.<span style="color: black;">catastrophe</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            best_dna <span style="color: #66cc66;">=</span> Record.<span style="color: black;">dna</span>
            Record.<span style="color: black;">set_best</span><span style="color: black;">&#40;</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>
            dnas <span style="color: #66cc66;">=</span> get_gp_dnas<span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>CS<span style="color: black;">&#41;</span>*P_LEN<span style="color: black;">&#41;</span>
            best_dna <span style="color: #ff7700;font-weight:bold;">and</span> dnas.<span style="color: black;">append</span><span style="color: black;">&#40;</span>best_dna<span style="color: black;">&#41;</span>
        dnas <span style="color: #66cc66;">=</span> count_fit_rate<span style="color: black;">&#40;</span>dnas<span style="color: #66cc66;">,</span> Record<span style="color: black;">&#41;</span>
        dnas <span style="color: #66cc66;">=</span> mate<span style="color: black;">&#40;</span>dnas<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span> Record.<span style="color: black;">dna</span>.<span style="color: black;">get_cost</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span> Record.<span style="color: black;">dna</span>
    <span style="color: #808080; font-style: italic;">#print time.clock() - start_t</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">if</span> __name__<span style="color: #66cc66;">==</span><span style="color: #483d8b;">"__main__"</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">sys</span>.<span style="color: black;">argv</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">!=</span><span style="color: #ff4500;">2</span>:
        <span style="color: #dc143c;">sys</span>.<span style="color: black;">exit</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
    fpath <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">argv</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
&nbsp;
    read_data<span style="color: black;">&#40;</span>fpath<span style="color: black;">&#41;</span>
    run<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre>
      </td>
    </tr>
  </table>
</div>

&nbsp;

&nbsp;

附谜题内容:
  
原题网址: <a href="http://www.wmsstech.com/puzzles_view_chemical.html" target="_blank">文明盛世超能饮料谜题</a>

原题内容:

<pre id="src">超能饮料 (关键字: chemical)
文明盛世旗下的化工产品实验室一直在研究如何配制能够提高工程师生产效率、保持他们头脑清醒的新型兴奋剂。研究已经分离了一系列化合物，当它们和糖水混合在一起就成为了下一代超能饮料的活性成分。

这些化合物成分类似：任何一种化合物都可经由某一化学反应，成为其它任意一种化合物。实际进行化学反应的成本很低，但使反应发生的设备和催化剂成本相当高昂。把某一化合物转换为另一化合物时所使用的设备，也都必须单独定制。每件设备都会产生购置费用，并且需要投入某种化合物才能产出另外一种化合物。文明盛世实验室必须配备足够设备，确保无论市场上能买到哪些化合物，都能产出整个系列的化合物。

编写仅带一个命令行参数的程序。该参数必须是一个包括输入数据的文件名。此程序应该输出最便宜的方案到标准输出，使文明盛世公司能够利用源化合物或多个化合物生产其饮料（输出详情请参见下文）。我们假设设备目录中提到的所有化学品都是配制饮品的必要原料。我们不保证所有的化学反应都能一步到位，不过我们保证任何一种化合物都能经由反应，转变为其它任意一种化合物。参与者提交的谜题结果和程序方案都必须遵循下面的输入、输出规范，否则将会被视为不合格。参与者提交的程序将会在几个数据不同的设备目录上测试。此外，参与者提交的程序运行速度必须很快，能在数分钟内给出正确方案。


输入规范
输入文件中需要包含可用设备列表。文件的每一行都代表一个特定的设备型号。每一行的格式如下：
      （分别对应的中文意思是设备名称、源化合物、新化合物、价格）

设备名称要以字母‘M’开头（不要带引号）后跟一个非零整数。设备的名称可以是‘M1’、‘M2’、‘M13’等。

化合物名称要以字母‘C’开头（不要带引号）后跟一个非零整数。化合物的名称可以是‘C4’、‘C6’、‘C24’等。

价格请用简单的非零整数，请勿使用逗号、句号或单位符号（我们假设所有价格的单位都是美元）。如：‘987334’、‘13948295’等。

请在输入文件的段落之间用空格或制表符隔开。最后一项的行尾可以加入空格（也可以不加）。要确保所提交的程序能够通过数据格式正确的输入文件的运行验证。

输入文件示例：
M1      C1      C2      277317
M2      C2      C1      26247
M3      C1      C3      478726
M4      C3      C1      930382
M5      C2      C3      370287
M6      C3      C2      112344

输出规范
请严格按照以下说明进行输出：参与者的程序必须首先输出购买所需设备的总价（请勿插入逗号、句号或其它任何符号），这个总价请用简单整数表示，结尾另起一行。

然后参与者提交的程序需打印所购买的设备编号，以升序排列并省略标志字符’M’。设备编号之间必须用一个空格隔开。程序应该在最后一个设备编号后另起一行，而不能再加入空格。

输出示例（每行末尾需另起一行）
617317
2  3  6</pre>
